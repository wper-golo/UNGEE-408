![[image-20221209220216210.png]]

## 两种交换方式

- 存储转发
	- 先缓存后处理
- 直通交换
	- 收到数据帧的同时就按数据帧的目的MAC地址决定转发接口
	- 优点：提高转发速度，时延小
	- 缺点：有可能转发无效帧

## 工作流程

1. 交换机从一个端口中收到一个需要转发的数据帧
2. 交换机读取数据帧头中的源Mac地址，以此判断发送此包的主机连接哪一个端口，Mac是什么，加入到地址表中（**自学习**）
3. 读取头部的目的Mac地址
4. 在地址表中查找目的Mac对应的端口
	1. 如果地址表中有端口，将数据帧复制转发到对应的端口中去（**转发**）
	2. 如果没有，则转发到所有的端口。下一次对应端口有回应，再将其地址加入地址表。（**自学习**）

## 自学习与转发的例子

![[image-20221209214456654.png]]
1.  A 先向 B 发送一帧。该帧从接口 1 进入到交换机
2.  交换机收到帧后，先查找（图中左边）交换表。没有查到应从哪个接口转发这个帧给 B
3.  交换机把这个帧的源地址 A 和接口 1 写入（图中左边）交换表中
4.  交换机向除接口 1 以外的所有的接口广播这个帧
5.  接口 4到接口 2，先查找（图中右边）交换表。没有查到应从哪个接口转发这个帧给 B
6.  交换机把这个帧的源地址 A 和接口 1 写入（图中右边）交换表中
7.  除B主机之外与该帧的目的地址不相符，将丢弃该帧
8.  主机B发现是给自己的帧，接受该帧

![[image-20221209214540107.png]]
1.  B 向 A 发送一帧。该帧从接口 3 进入到交换机
2.  交换机收到帧后，先查找（图中左边）交换表。发现（图中左边）交换表中的 MAC 地址有 A，表明要发送给A的帧应从接口1转发出去。于是就把这个帧传送到接口 1 转发给 A。
3.  主机 A 发现目的地址是它，就接受该帧
4.  交换机把这个帧的源地址 B 和接口 3 写入（图中左边）交换表中

![[image-20221209214650061.png]]
1.  E 向 A发送一帧
2.  交换机收到帧后，先查找（图中右边）交换表。发现（图中右边）交换表中的 MAC 地址有 A，表明要发送给A的帧应从接口2转发出去。于是就把这个帧传送到接口 2 转发给 接口 4。
3.  交换机把这个帧的源地址 E 和接口 3 写入（图中右边）交换表中
4.  接口 4 到 左边的交换机，先查找（图中左边）交换表。发现（图中左边）交换表中的 MAC 地址有 A，表明要发送给A的帧应从接口1转发出去。于是就把这个帧传送到接口 1 转发给 A。
5.  交换机把这个帧的源地址 E 和接口 4 写入（图中左边）交换表中
6.  主机 A 发现目的地址是它，就接受该帧

![[image-20221209214717157.png]]
主机 A、主机 G、交换机 1的接口 1就共享同一条总线（相当于总线式网络，可以想象成用集线器连接了）
1.  主机 G 发送给 主机 A 一个帧
2.  主机 A 和 交换机接口 1都能接收到
3.  主机 A 的网卡收到后，根据帧的目的MAC地址A，就知道是发送给自己的帧，就接受该帧
4.  交换机 1收到该帧后，首先进行登记工作
5.  然后交换机 1对该帧进行转发，该帧的MAC地址是A，在（图中左边）交换表查找MAC 地址有 A
6.  MAC 地址为 A的接口号是1，但是该帧正是从接口 1 进入交换机的，交换机不会再从该接口 1 将帧转发出去，因为这是没有必要，于是丢弃该帧

## 生成树协议STP

以太网交换机的[[生成树协议]]可以提高网络的可靠性
