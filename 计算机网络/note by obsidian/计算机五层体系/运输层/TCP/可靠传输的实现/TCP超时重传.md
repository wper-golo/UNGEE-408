TCP的超时重传时间的选择是个难题。
**超时重传时间，又称RTO**
**往返时间，又称RTT**

![[image-20221220235228732.png]]
![[image-20221220235243664.png]]

由上面可知
- 超时重传时间过短，会产生不必要的重传，导致网络负荷变大
- 超时重传时间过长，网络的空闲时间增大，降低传输的效率

最好的办法：
![[image-20221220235551391.png]]

那么这个时间怎么确定呢？
![[image-20221220235628746.png]]

即公式$$RTT_s=(1-\alpha)*RTT_s^{old}+\alpha*RTT_i$$
其中：$RTT_s$代表平均往返时间；$RTT_S^{old}$代表旧的平均往返时间；$RTT_i$代表新的RTT样本
- 若$\alpha$的值接近0，则新样本对平均值$RTT_s$影响较小
- 若$\alpha$的值接近1，则新样本对平均值$RTT_s$影响较大
（本质是利用加权平均使RTT趋向于更稳定的值）

RFC6298建议的RTO算法
![[image-20221221000155431.png]]

那么要求一个RTO，剩下的就是如歌测量RTT的时间了
![[image-20221221000304275.png]]
![[image-20221221000326324.png]]
>这种特殊情况的解释：
>假设RTO正好，不大不小
>突然一股外来因素导致网络时延非常大，并且这样的不良因素会在接下来一段时间持续影响网络，也就是接下来一段时间网络时延都会很大
>时延导致目标并没有按照原来的不大不小的RTO内回传确认信息，因此发送端误以为是丢包了，于是进行重传
>因为是发送端以为丢包导致的重传，就表示该次RTT不hi影响RTO
>RTO不改变，就会一直重传
>解决的关键是重传不能让RTO不变，以此排除网络因素的干扰（因为重传可能是网络丢包或时延导致）

举例计算：
![[image-20221221001013963.png]]

